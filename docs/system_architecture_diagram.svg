<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 850">
  <!-- Styles -->
  <style>
    .bg { fill: #f8f9fa; }
    .box { fill: #ffffff; stroke: #333; stroke-width: 2; rx: 8; ry: 8; }
    .box-header { fill: #e9ecef; stroke: #333; stroke-width: 0 0 1 0; }
    .title { font-family: 'Segoe UI', sans-serif; font-size: 16px; font-weight: bold; text-anchor: middle; fill: #333; }
    .label { font-family: 'Segoe UI', sans-serif; font-size: 14px; text-anchor: middle; fill: #555; }
    .sub-label { font-family: 'Segoe UI', sans-serif; font-size: 12px; text-anchor: middle; fill: #777; }
    .arrow { stroke: #333; stroke-width: 2; marker-end: url(#arrowhead); fill: none; }
    .arrow-dashed { stroke: #555; stroke-width: 2; stroke-dasharray: 5,5; marker-end: url(#arrowhead); fill: none; }
    .db-cylinder { fill: #e3f2fd; stroke: #1565c0; stroke-width: 2; }
    .component-box { fill: #e8f5e9; stroke: #2e7d32; stroke-width: 1.5; rx: 5; ry: 5; }
    .component-text { font-family: monospace; font-size: 12px; text-anchor: middle; fill: #1b5e20; }
    .zone-label { font-family: 'Segoe UI', sans-serif; font-size: 18px; font-weight: bold; fill: #444; text-transform: uppercase; letter-spacing: 1px; }
  </style>

  <!-- Defs for markers -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>

  <!-- Background -->
  <rect width="100%" height="100%" class="bg" />

  <!-- ZONES -->
  <!-- Source Zone -->
  <rect x="50" y="80" width="200" height="700" fill="#fff3e0" fill-opacity="0.3" rx="10" />
  <text x="150" y="60" class="zone-label" text-anchor="middle">Data Sources</text>

  <!-- Ingestion & Processing Zone -->
  <rect x="300" y="80" width="300" height="700" fill="#e1f5fe" fill-opacity="0.3" rx="10" />
  <text x="450" y="60" class="zone-label" text-anchor="middle">Orchestration (ETL &amp; ML)</text>

  <!-- Storage Zone -->
  <rect x="650" y="80" width="200" height="700" fill="#f3e5f5" fill-opacity="0.3" rx="10" />
  <text x="750" y="60" class="zone-label" text-anchor="middle">Data Warehouse</text>

  <!-- Application Zone -->
  <rect x="900" y="80" width="250" height="700" fill="#e8f5e9" fill-opacity="0.3" rx="10" />
  <text x="1025" y="60" class="zone-label" text-anchor="middle">Application Layer</text>

  <!-- COMPONENTS -->

  <!-- 1. Canvas LMS -->
  <g transform="translate(75, 200)">
    <rect width="150" height="120" class="box" stroke="#e65100" />
    <text x="75" y="30" class="title">Canvas LMS</text>
    <text x="75" y="55" class="label">Rails + Postgres</text>
    <text x="75" y="80" class="sub-label">REST API v1</text>
    <text x="75" y="100" class="sub-label">(Courses, Users, Subs)</text>
  </g>

  <!-- 2. Airflow -->
  <g transform="translate(325, 150)">
    <rect width="250" height="400" class="box" stroke="#0277bd" />
    <text x="125" y="30" class="title">Apache Airflow</text>
    <text x="125" y="50" class="sub-label">@hourly Schedule</text>
    
    <!-- Tasks inside Airflow -->
    <g transform="translate(25, 70)">
        <rect width="200" height="40" class="component-box" />
        <text x="100" y="25" class="component-text">1. extract_courses</text>
    </g>
    <path d="M125 110 L125 130" class="arrow" transform="translate(325, 150)" />
    
    <g transform="translate(25, 130)">
        <rect width="200" height="40" class="component-box" />
        <text x="100" y="25" class="component-text">2. extract_submissions</text>
    </g>
    <path d="M125 170 L125 190" class="arrow" transform="translate(325, 150)" />

    <g transform="translate(25, 190)">
        <rect width="200" height="40" class="component-box" />
        <text x="100" y="25" class="component-text">3. transform_and_load</text>
    </g>
    <path d="M125 230 L125 250" class="arrow" transform="translate(325, 150)" />

    <g transform="translate(25, 250)">
        <rect width="200" height="40" class="component-box" fill="#fff3e0" stroke="#ef6c00" />
        <text x="100" y="25" class="component-text" fill="#ef6c00">4. train_ml (LogReg)</text>
    </g>
    <path d="M125 290 L125 310" class="arrow" transform="translate(325, 150)" />

    <g transform="translate(25, 310)">
        <rect width="200" height="40" class="component-box" />
        <text x="100" y="25" class="component-text">5. build_features</text>
    </g>
  </g>

  <!-- 3. Postgres DWH -->
  <g transform="translate(675, 250)">
    <path d="M0,20 A75,20 0 1,1 150,20 A75,20 0 1,1 0,20 M0,20 L0,200 A75,20 0 1,0 150,200 L150,20 A75,20 0 1,0 0,20" class="db-cylinder" />
    <text x="75" y="80" class="title">PostgreSQL</text>
    <text x="75" y="100" class="label">canvas_dwh</text>
    <line x1="10" y1="120" x2="140" y2="120" stroke="#1565c0" />
    <text x="75" y="140" class="sub-label">Fact/Dim Tables</text>
    <text x="75" y="160" class="sub-label">Analytic Tables</text>
    <text x="75" y="180" class="sub-label">ML Predictions</text>
  </g>

  <!-- 4. Backend API -->
  <g transform="translate(925, 200)">
    <rect width="200" height="120" class="box" stroke="#2e7d32" />
    <text x="100" y="30" class="title">Backend API</text>
    <text x="100" y="55" class="label">Node.js + Express</text>
    <text x="100" y="80" class="sub-label">Port: 4000</text>
    
    <!-- Gemini Integration -->
    <g transform="translate(130, -50)">
        <rect width="80" height="40" rx="5" fill="#f3e5f5" stroke="#8e24aa" />
        <text x="40" y="25" font-size="10" text-anchor="middle" fill="#8e24aa">Gemini AI</text>
        <path d="M40 40 L40 60 L-10 80" class="arrow-dashed" marker-end="url(#arrowhead)" />
    </g>
  </g>

  <!-- 5. Frontend -->
  <g transform="translate(925, 450)">
    <rect width="200" height="120" class="box" stroke="#1565c0" />
    <text x="100" y="30" class="title">Dashboard</text>
    <text x="100" y="55" class="label">React + Vite</text>
    <text x="100" y="80" class="sub-label">D3.js Charts</text>
    <text x="100" y="100" class="sub-label">Port: 5173</text>
  </g>

  <!-- CONNECTIONS -->
  
  <!-- Canvas -> Airflow -->
  <path d="M225 260 L325 260" class="arrow" />
  <text x="275" y="250" class="sub-label">JSON Data</text>

  <!-- Airflow -> DWH (Write) -->
  <path d="M575 350 L675 350" class="arrow" />
  <text x="625" y="340" class="sub-label">SQL Insert</text>

  <!-- DWH -> Airflow (Read for ML) -->
  <path d="M675 400 L575 400" class="arrow" stroke-dasharray="5,5" />
  <text x="625" y="420" class="sub-label">Fetch Training Data</text>

  <!-- Backend -> DWH (Read) -->
  <path d="M925 260 L825 300" class="arrow" />
  <text x="880" y="275" class="sub-label">SQL Select</text>

  <!-- Frontend -> Backend -->
  <path d="M1025 450 L1025 320" class="arrow" />
  <text x="1060" y="390" class="sub-label">REST JSON</text>
  
  <!-- User Access -->
  <g transform="translate(1080, 600)">
    <circle cx="20" cy="20" r="15" fill="#ddd" stroke="#333" />
    <path d="M5,45 Q20,60 35,45" stroke="#333" fill="none" />
    <line x1="20" y1="35" x2="20" y2="55" stroke="#333" />
    <text x="20" y="80" class="sub-label">User (Teacher)</text>
  </g>
  <path d="M1100 600 L1080 570" class="arrow" />

  <!-- Legend -->
  <g transform="translate(50, 750)">
     <rect width="1100" height="60" fill="white" stroke="#ccc" rx="5" />
     <text x="50" y="35" font-weight="bold" fill="#333">Legend:</text>
     
     <rect x="120" y="20" width="20" height="20" class="box" stroke="#e65100" />
     <text x="150" y="35" class="sub-label">External System</text>
     
     <rect x="250" y="20" width="20" height="20" class="box" stroke="#0277bd" />
     <text x="280" y="35" class="sub-label">Orchestrator</text>
     
     <rect x="380" y="20" width="20" height="20" fill="#e3f2fd" stroke="#1565c0" />
     <text x="410" y="35" class="sub-label">Database</text>
     
     <line x1="500" y1="30" x2="540" y2="30" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
     <text x="550" y="35" class="sub-label">Data Flow</text>
  </g>

</svg>