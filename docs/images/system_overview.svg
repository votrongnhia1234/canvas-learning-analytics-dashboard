<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1000" height="560" viewBox="0 0 1000 560">
  <style>
    .title{font:700 20px sans-serif;fill:#111}
    .label{font:13px sans-serif;fill:#111}
    .small{font:12px sans-serif;fill:#333}
    .box{stroke:#333;stroke-width:1;fill:#f6f6f6}
    .box-yellow{fill:#f9e79f}
    .box-blue{fill:#aed6f1}
    .box-red{fill:#fadbd8}
    .box-green{fill:#d5f5e3}
    .box-pink{fill:#f2d7d5}
    .box-tan{fill:#f6ddcc}
    .arrow{stroke:#111;stroke-width:1.5;marker-end:url(#arrow)}
  </style>
  <defs>
    <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#111" />
    </marker>
  </defs>
  <rect width="100%" height="100%" fill="#fff"/>
  <text x="500" y="32" text-anchor="middle" class="title">Learning Analytics - System Architecture &amp; Data Flow</text>

  <!-- Row of core components -->
  <g transform="translate(40,80)">
    <!-- Canvas LMS -->
    <rect class="box" x="0" y="20" width="220" height="100" rx="8" ry="8"/>
    <text class="label" x="110" y="54" text-anchor="middle">Canvas LMS</text>
    <text class="small" x="110" y="76" text-anchor="middle">Rails + PostgreSQL</text>
    <text class="small" x="110" y="96" text-anchor="middle">/api/v1/*</text>

    <!-- Airflow ETL -->
    <rect class="box box-yellow" x="250" y="20" width="220" height="100" rx="8" ry="8"/>
    <text class="label" x="360" y="54" text-anchor="middle">Apache Airflow</text>
    <text class="small" x="360" y="76" text-anchor="middle">ETL @hourly</text>
    <text class="small" x="360" y="96" text-anchor="middle">Extract + Transform + Load</text>

    <!-- DWH -->
    <rect class="box box-blue" x="500" y="20" width="220" height="100" rx="8" ry="8"/>
    <text class="label" x="610" y="54" text-anchor="middle">Data Warehouse</text>
    <text class="small" x="610" y="76" text-anchor="middle">Postgres: canvas_dwh</text>
    <text class="small" x="610" y="96" text-anchor="middle">dim_*, fact_*</text>

    <!-- ML -->
    <rect class="box box-red" x="750" y="20" width="220" height="100" rx="8" ry="8"/>
    <text class="label" x="860" y="54" text-anchor="middle">ML Pipeline</text>
    <text class="small" x="860" y="76" text-anchor="middle">Logistic Regression</text>
    <text class="small" x="860" y="96" text-anchor="middle">student_features, risk_by_course</text>

    <!-- Arrows row 1 -->
    <line class="arrow" x1="220" y1="70" x2="250" y2="70"/>
    <line class="arrow" x1="470" y1="70" x2="500" y2="70"/>
    <line class="arrow" x1="720" y1="70" x2="750" y2="70"/>
  </g>

  <!-- Row of delivery components -->
  <g transform="translate(140,230)">
    <!-- Backend API -->
    <rect class="box box-green" x="0" y="0" width="260" height="90" rx="8" ry="8"/>
    <text class="label" x="130" y="30" text-anchor="middle">Backend API</text>
    <text class="small" x="130" y="52" text-anchor="middle">Node.js / Express :4000</text>
    <text class="small" x="130" y="72" text-anchor="middle">/api/overview | /api/heatmap | /api/trends</text>

    <!-- Frontend -->
    <rect class="box box-pink" x="300" y="0" width="260" height="90" rx="8" ry="8"/>
    <text class="label" x="430" y="30" text-anchor="middle">Frontend Dashboard</text>
    <text class="small" x="430" y="52" text-anchor="middle">React + D3.js :5173</text>
    <text class="small" x="430" y="72" text-anchor="middle">VITE_API_PROXY -> :4000</text>

    <!-- Canvas Embed -->
    <rect class="box box-tan" x="600" y="0" width="260" height="90" rx="8" ry="8"/>
    <text class="label" x="730" y="30" text-anchor="middle">Canvas LMS /learning_analytics</text>
    <text class="small" x="730" y="52" text-anchor="middle">iframe -> http://localhost:5173</text>
    <text class="small" x="730" y="72" text-anchor="middle">Global Nav Entry</text>

    <!-- Arrows row 2 -->
    <line class="arrow" x1="260" y1="45" x2="300" y2="45"/>
    <line class="arrow" x1="560" y1="45" x2="600" y2="45"/>
  </g>

  <!-- Vertical connections from DWH/ML to Backend -->
  <g>
    <line class="arrow" x1="650" y1="180" x2="400" y2="230"/>
    <text class="small" x="520" y="202">DB queries</text>
    <line class="arrow" x1="860" y1="180" x2="400" y2="230"/>
    <text class="small" x="740" y="202">Predictions</text>
  </g>

  <!-- Annotation: Security & Config -->
  <g transform="translate(40,360)">
    <text class="label">Security &amp; Configuration</text>
    <text class="small" y="24">- Airflow uses CANVAS_API_TOKEN; Backend API_KEY; limited CORS_ORIGIN.</text>
    <text class="small" y="44">- Indexing: idx_fact_submissions_course_time, idx_student_features_risk_prob.</text>
  </g>
</svg>
